{% extends "layout.html" %}

{% block title %}
    Dashboard
{% endblock %}

{% block main %}
    <div class="container">
        <h4 class="mb-3">Top Stories</h4>
        <hr>
        
        <!-- https://getbootstrap.com/docs/4.0/components/list-group/ -->
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <!-- Healine and toggle icon -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Headline</h5>
                    <button class="btn btn-sm btn-link" 
                            type="button" 
                            data-bs-toggle="collapse" 
                            data-bs-target="#summary" 
                            aria-expanded="false" 
                            aria-controls="summary">
                        <i class="bi bi-caret-down-fill text-secondary"></i>
                    </button>
                </div>

                <!-- Collapsible content -->
                <div class="collapse my-2 ms-5 text-start" id="summary">
                    <p class="mb-0">Summary ....</p>
                </div>
            </li>        
        </ul>
    </div>   
    
    <!-- {% if news_ready == 0 %}
    <script type="module">

        async function summarizeArticles() {

            // Ensure browser supports api
            if ('Summarizer' in self) {

                // Headline summarizer
                const headlines = {
                    sharedContext: "",
                    type: "headline",
                    format: "plain-text",
                    length: "short"
                };

                // Bullet point summarizer
                const bullets = {
                    sharedContext: "",
                    type: "key-points",
                    format: "plain-text",
                    length: "medium"
                };

                const availability = await Summarizer.availability();
                if (availability === 'unavailable') {
                    // The Summarizer API isn't usable.
                    return;
                }

                // Check for user activation before creating the summarizer
                if (navigator.userActivation.isActive) {
                    
                    // Download the model only once
                    const monitor = (m) => {
                        m.addEventListener("downloadprogress", (e) => {
                            console.log(`Model ${Math.round(e.loaded * 100)}% downloaded`);
                        });
                    };

                    // Create summarizers
                    const summarizerH = await Summarizer.create(headlines);
                    const summarizerB = await Summarizer.create(bullets);
                }

                // Store urls from flask in a list
                const articleUrls = [];

                // Summarize articles
                for (const url of articleUrls) {

                    // Parse article text via url
                    text = ;

                    // Generate summaries
                    const heading = await summarizerH.summarize(text, {
                        context: '';
                    });
                    const summary = await summarizerB.summarize(text, {
                        context: '';
                    });

                    // Populate the summary above somehow
                }
            }
        }

    </script>
    {% endif %}-->
{% endblock %}